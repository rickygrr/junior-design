{"ast":null,"code":"import { getIndex } from '../utils';\n/**\n * @hidden\n */\n\nvar CommonDragLogic =\n/** @class */\nfunction () {\n  function CommonDragLogic(columnReorder, groupReorder, columnToGroup) {\n    var _this = this;\n\n    this.reorderable = false;\n    this.groupable = false;\n    this.startColumn = -1;\n    this.startGroup = -1;\n    this.currentColumn = -1;\n    this.currentGroup = -1;\n    this.dropElementClue = null;\n    this.dragElementClue = null;\n    this.groupPanelDivElement = null;\n\n    this.refGroupPanelDiv = function (e) {\n      _this.groupPanelDivElement = e;\n    };\n\n    this.refDropElementClue = function (e) {\n      _this.dropElementClue = e;\n    };\n\n    this.refDragElementClue = function (e) {\n      _this.dragElementClue = e;\n    };\n\n    this.pressHandler = function (event, element) {\n      if (!event.isTouch) {\n        event.originalEvent.preventDefault();\n      }\n\n      var startColumn = _this.getColumnIndex(event, element);\n\n      _this.startGroup = _this.getGroupIndex(event);\n\n      if (startColumn >= 0) {\n        var col = _this.columns[startColumn];\n\n        if (col.reorderable && _this.reorderable || col.groupable && _this.groupable) {\n          _this.startColumn = startColumn;\n        }\n      }\n    };\n\n    this.dragHandler = function (event, element) {\n      if (!event.isTouch) {\n        event.originalEvent.preventDefault();\n      }\n\n      event.originalEvent.stopPropagation();\n\n      if (_this.startColumn === -1 && _this.startGroup === -1) {\n        return;\n      }\n\n      _this.currentColumn = _this.getColumnIndex(event, element);\n      _this.currentGroup = _this.getGroupIndex(event);\n\n      if (_this.groupPanelDivElement && _this.startGroup >= 0) {\n        _this.currentGroup = Math.min(_this.currentGroup, _this.groupPanelDivElement.children.length - 2);\n      }\n\n      var invalidIndex = !_this.isValid();\n\n      if (invalidIndex) {\n        _this.currentColumn = -1;\n        _this.currentGroup = -1;\n      }\n\n      var targetElement = _this.currentColumn >= 0 ? element.children[_this.columns[_this.currentColumn].index] : _this.groupPanelDivElement && _this.groupPanelDivElement.children[_this.currentGroup];\n\n      _this.updateDragElementClue(event, element, targetElement, invalidIndex);\n\n      _this.updateDropElementClue(event, element, targetElement, invalidIndex);\n    };\n\n    this.releaseHandler = function (event) {\n      var prevColumnIndex = _this.startColumn;\n      var nextColumnIndex = _this.currentColumn;\n      var prevGroupIndex = _this.startGroup;\n      var nextGroupIndex = _this.currentGroup;\n\n      if (_this.dropElementClue) {\n        _this.dropElementClue.setState({\n          visible: false\n        });\n      }\n\n      if (_this.dragElementClue) {\n        _this.dragElementClue.setState({\n          visible: false\n        });\n      }\n\n      var isValid = _this.isValid();\n\n      _this.startColumn = _this.startGroup = _this.currentColumn = _this.currentGroup = -1;\n\n      if (!isValid) {\n        return;\n      }\n\n      if (prevColumnIndex >= 0 && nextColumnIndex >= 0) {\n        _this.columnReorder(prevColumnIndex, nextColumnIndex, event.originalEvent);\n      } else if (prevGroupIndex >= 0 && nextGroupIndex >= 0) {\n        _this.groupReorder(prevGroupIndex, nextGroupIndex, event.originalEvent);\n      } else if (prevColumnIndex >= 0 && nextGroupIndex >= 0) {\n        _this.columnToGroup(prevColumnIndex, nextGroupIndex, event.originalEvent);\n      }\n    };\n\n    this.columnReorder = columnReorder;\n    this.groupReorder = groupReorder;\n    this.columnToGroup = columnToGroup;\n  }\n\n  CommonDragLogic.prototype.getColumnIndex = function (event, parent) {\n    if (!parent || parent.parentElement === this.groupPanelDivElement) {\n      return -1;\n    }\n\n    var index = getIndex(event, parent);\n\n    if (index === -1) {\n      return -1;\n    }\n\n    var _loop_1 = function (i) {\n      if (parent.parentNode.children[i] === parent) {\n        return {\n          value: this_1.columns.findIndex(function (c) {\n            return c.index === index && c.depth === i;\n          })\n        };\n      }\n    };\n\n    var this_1 = this;\n\n    for (var i = 0; i < parent.parentNode.children.length; i++) {\n      var state_1 = _loop_1(i);\n\n      if (typeof state_1 === \"object\") return state_1.value;\n    }\n\n    return -1;\n  };\n\n  CommonDragLogic.prototype.getGroupIndex = function (event) {\n    return getIndex(event, this.groupPanelDivElement);\n  };\n\n  CommonDragLogic.prototype.isValid = function () {\n    if (this.startGroup >= 0) {\n      // group can be moved into group only\n      return this.currentGroup >= 0 && this.currentGroup !== this.startGroup;\n    }\n\n    if (this.startColumn === -1) {\n      return false;\n    }\n\n    if (this.currentGroup >= 0) {\n      // column to group is possible\n      return this.columns[this.startColumn].groupable === true && this.groupable === true;\n    } // reorder is possible\n\n\n    return this.reorderable === true && this.currentColumn >= 0 && this.currentColumn !== this.startColumn && this.columns[this.startColumn].reorderable === true && this.columns[this.currentColumn].parentIndex === this.columns[this.startColumn].parentIndex;\n  };\n\n  CommonDragLogic.prototype.updateDragElementClue = function (event, element, targetElement, invalidIndex) {\n    if (!this.dragElementClue) {\n      return;\n    }\n\n    var innerText = this.startColumn >= 0 ? element.children[this.columns[this.startColumn].index].innerText : element.innerText;\n    this.dragElementClue.setState({\n      visible: true,\n      top: event.pageY + 10,\n      left: event.pageX,\n      innerText: innerText,\n      status: invalidIndex || !targetElement ? 'k-i-cancel' : 'k-i-add'\n    });\n  };\n\n  CommonDragLogic.prototype.updateDropElementClue = function (event, element, targetElement, invalidIndex) {\n    if (!this.dropElementClue) {\n      return;\n    }\n\n    if (invalidIndex || !targetElement) {\n      this.dropElementClue.setState({\n        visible: false\n      });\n      return;\n    }\n\n    var rect = targetElement.getBoundingClientRect();\n    var left = rect.left + event.pageX - event.clientX - 6;\n\n    if (this.currentColumn > this.startColumn || this.currentGroup > this.startGroup && this.startGroup !== -1) {\n      left += rect.width;\n    }\n\n    var top = rect.top + event.pageY - event.clientY;\n    this.dropElementClue.setState({\n      visible: true,\n      top: top,\n      left: left,\n      height: this.currentColumn >= 0 ? element.clientHeight : rect.height\n    });\n  };\n\n  return CommonDragLogic;\n}();\n\nexport { CommonDragLogic };","map":null,"metadata":{},"sourceType":"module"}